!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t():"function"==typeof define&&define.amd?define(t):t()}(0,function(){var e,t=require("typedarray-to-buffer"),n=require("atob"),i="undefined"!=typeof document&&"function"==typeof document.createElement;module.exports=function(a,o){var r=this;if((o=o||{}).image=o.image?o.image:{},o.image.types=o.image.types?o.image.types:[],o.image.types.length>2)throw new Error("Too many image types are specified!");o.image.types.length<1&&(o.image.types=i?["webp","jpeg"]:["png"]),o.image.quality||(o.image.quality=.5);var u=parseFloat(o.image.quality);function f(e){var t;return o.image.types[e]&&(t="image/"+o.image.types[e]),t}function c(e,t){var n=e&&e.match(t);return n&&o.debug&&o.debug("Image type %s verified",t),n}function g(){var e;return i?(e=document.createElement("canvas")).width=e.height=1:e=a,e}function l(e,t){try{g().toDataURL(e,function(n,i){n?t(n):t(null,c(i,e))})}catch(e){t(null,!1)}}function m(e){var t;try{var n=g();t=c(n.toDataURL&&n.toDataURL(e),e)}catch(t){o.debug&&o.logger.debug("Failed to call toDataURL() on canvas for image type %s",e)}return t}function y(e){var t=f(0);if(!e)return function(e){return m(e)||o.image.types[1]&&m(e=f(1))||(e=null),!e&&o.debug&&o.logger.debug("Unable to verify image type"),e}(t);!function(e,t){l(e,function(n,i){n?t(n):i?t(null,e):l(e=f(1),function(n,i){n?t(n):t(null,i?e:null)})})}(t,e)}function p(e){var i,a=e.split(",")[1];if("function"==typeof n)i=n(a);else{if("function"!=typeof r.constructor.atob)throw new Error("atob function is missing");i=r.constructor.atob(a)}for(var o=new Uint8Array(i.length),u=0,f=i.length;u<f;u++)o[u]=i.charCodeAt(u);return t(o)}this.toBuffer=function(e){if(!e)return(n=r.getImageType())&&(t=p(a.toDataURL(n,u))),t;var t,n;!function(e){r.getImageType(function(t,n){t?e(t):n?a.toDataURL(n,function(t,n){t?e(t):e(null,p(n))}):e()})}(e)},this.getImageType=function(t){if(!t)return e&&i||(e=y()),e;e&&i?t(null,e):y(function(n,i){n?t(n):t(null,e=i)})}}});
//# sourceMappingURL=canvas-to-buffer.umd.js.map
