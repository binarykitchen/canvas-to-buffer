var t=require("typedarray-to-buffer"),e=require("atob");function n(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var a,i=/*#__PURE__*/n(t),r=/*#__PURE__*/n(e),u="undefined"!=typeof document&&"function"==typeof document.createElement;module.exports=function(t,e){void 0===e&&(e={});var n=this;if(e.image=e.image?e.image:{},e.image.types=e.image.types?e.image.types:[],e.image.types.length>2)throw new Error("Too many image types are specified!");e.image.types.length<1&&(e.image.types=u?["webp","jpeg"]:["png"]),e.image.quality||(e.image.quality=.5);var o=parseFloat(e.image.quality);function f(t){var n;return e.image.types[t]&&(n="image/"+e.image.types[t]),n}function c(t,n){var a=t&&t.match(n);return a&&e.debug&&e.debug("Image type %s verified",n),a}function g(){var e;return u?(e=document.createElement("canvas")).width=e.height=1:e=t,e}function l(t,e){try{g().toDataURL(t,function(n,a){n?e(n):e(null,c(a,t))})}catch(t){e(null,!1)}}function m(t){var n;try{var a=g();n=c(a.toDataURL&&a.toDataURL(t),t)}catch(n){e.debug&&e.logger.debug("Failed to call toDataURL() on canvas for image type %s",t)}return n}function y(t){var n=f(0);if(!t)return function(t){return m(t)||e.image.types[1]&&m(t=f(1))||(t=null),!t&&e.debug&&e.logger.debug("Unable to verify image type"),t}(n);!function(t,e){l(t,function(n,a){n?e(n):a?e(null,t):l(t=f(1),function(n,a){n?e(n):e(null,a?t:null)})})}(n,t)}function p(t){var e,a=t.split(",")[1];if("function"==typeof r.default)e=r.default(a);else{if("function"!=typeof n.constructor.atob)throw new Error("atob function is missing");e=n.constructor.atob(a)}for(var u=new Uint8Array(e.length),o=0,f=e.length;o<f;o++)u[o]=e.charCodeAt(o);return i.default(u)}this.toBuffer=function(e){if(!e)return(i=n.getImageType())&&(a=p(t.toDataURL(i,o))),a;var a,i;!function(e){n.getImageType(function(n,a){n?e(n):a?t.toDataURL(a,function(t,n){t?e(t):e(null,p(n))}):e()})}(e)},this.getImageType=function(t){if(!t)return a&&u||(a=y()),a;a&&u?t(null,a):y(function(e,n){e?t(e):t(null,a=n)})}};
//# sourceMappingURL=canvas-to-buffer.cjs.map
